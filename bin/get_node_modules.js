// get node module from process.cwd
var fs = require('fs'),
    // path = require('path'),
    process = require('process');

var prjPath = process.cwd();
// choose a platform specific separator
var sep = prjPath.indexOf("/") > -1 ? "/" : "\\";

module.exports = function (moduleName, pathname) {
    var m;
    var moduleLocation = ('/node_modules/' + moduleName + '/' + pathname).replace(/\//g, sep);

    /// now try to use the node_modules folder from the project folder (we're saying the project folder is where the config is...)
    /// we'll add a bunch of paths for require to check.
    while (prjPath.indexOf(sep) > -1) {
        prjPath = prjPath.slice(0, prjPath.lastIndexOf(sep));

        if(fs.existsSync(prjPath + moduleLocation)) {
            m = require(prjPath + moduleLocation);
            break;
        }
    }

    if (!m) {
        m = require(moduleName);
    }

    return m;
};
